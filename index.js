// yunzai-doro-plugin/index.js
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import fs from 'node:fs';


const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const pluginName = path.basename(__dirname);

logger.info(`[${pluginName} Index] __dirname is: ${__dirname}`);


const appsPath = path.join(__dirname, 'apps');

logger.info(`[${pluginName} Index] Calculated appsPath is: ${appsPath}`); // 打印确认

logger.info(`---------`);
logger.info(`【${pluginName}】载入成功`);
logger.info(`   _____                       `);
logger.info(`  |  __ \\                      `);
logger.info(`  | |  | |_ __ __ _  __ _ ___ `);
logger.info(`  | |  | | '__/ _\` |/ _\` / __|`);
logger.info(`  | |__| | | | (_| | (_| \\__ \\`);
logger.info(`  |_____/|_|  \\__,_|\\__, |___/`);
logger.info(`                     __/ |    `);
logger.info(`                    |___/     `);
logger.info(`[原作者] ttq7 ATTomatoo(移植: 429)`);
logger.info(`[版本] js版本`);
logger.info(`[用法] /doro 开始, /选择 A 进行选择`);
logger.info(`---------`);

// --- 在这里添加可爱的 Doro ASCII Art ---
logger.info('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#***++*********#%@@@@@@@@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@@@@#*++=-=+*###%*====-:----+++#++++++=---=*#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@%*++*##*+==+%#*=.:-=*%%%#*=-+=-+##%%%-=*+=:=+=*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@%+=*#%%+--==:-%*:=**+=:-#%%%%#=:#%%%#%:=%%#+=-=*==@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@*=*%%%+==*#+-*%%##==#%%%+:+%##%%*:+%#%=-%#-.-+##-++=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@%=+%%%#-+#%%%*#%%%%%%*#%##%%==%%%#%%-=%%:*#--:#+--#:+:#@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@#-*%%%#-#%%###%%%%%%%%%%#%%#%%==%%%#%%=-%:+-*%:=-.=-+.+:#***@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@*-#%%%#-%%%#%%#%%%%%%%%##%+#%%%@-=%%%##%--#:.*%*.-.+: :-+%%%-=@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@+-%%#%#-%%%%%*+%%%%%%%%%%%%+:%%%%%:*%####%:+%*==++==::= -@@@@-=@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@%=+%%#%%-*%%%%+:#%%%%%%%%%=#%%.*%%#%#:%##%#%#.#%%#***+++- :-+*+ %@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@%+-*%#%#%+=%#%%+ +%##%%%%%#%-*%%:+%#%#%-+%####%--#++++==:-=+-:@%#*:@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@#+-+%%#%%%%-#%#%=*#-%#%**%###%-*%#.:#%##%+-%####%#.-==--.-.:::=-%@@=-@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@+.=**=*%%%%*-%%#: -+.+%%+:%####-#%++%=*%%%*-%###%#%:.==-::: -=-+*-*+ =%@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@##*:#%%#%*=%*=.-*#=.-*%:+%#%=:*= =++-:=##-######%:+#*#+=+-*-+-:%+ +=.-#@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@%=%#%%%+:+*:=+**+=:.=+.*%*.:.:=:  .::.--%##%%#%:+%%%==*:#%++%@@.*@@+.=@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@%-%#%#==*@%:#*****#:-#==+*=:**:-##---##-%#####%:*%#%-:=:=@@@@%:+@@@@% -@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@-#%*-*@@%@+=##%##=-@@@@@@%%@.-=++==:-+=%######:#%%# +:*@@@@#.+@@@@@@# *@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@-*%-*@%%%%@#++++*%@@@@@@@@@#.##***#*::#%####%+:%%%:-@*=@@@+.#@@@@@@@@.:@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@+=%-+@%%%%%@@@@@@+@@@##@@@@@+=####*=-=%#####%:+%*:+@@@-#@= @@@@@@@@@@- @@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@:##-+%@@@%%%%@@@+=*==-++#@@@#++++#*-%%#%%#%*.*==%@@@@%-+.%@@@@@@@@@@= @@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@*=%#+=+*%@@@@@@@@%#%@@#%@@@@@@@@@*=%##%%#%# .=#@@@@@@@%*@@@@@@@@@@@@-.@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@==%%##*+==*#%@@@@@@@@@@@@@@%%%*=+*+:+%#%%:-%@@@@@@@@@@@@@@@@@@@@@@@.=@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@+=#%*#%#.:#************++*+-:-+*##:#%%#:+@@@@@@@@@@@@@@@@@@@@@@@@- %@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@#=** -**.-@@@@@@@@@@@@@@@@@@@@@@-*%%+-#@@@@@@@@@@@@@+*@@@@@@@@@:.%@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@*+ .#*++@@@@@@@@@@@@@@@@@@@%+-*#+=+@@@@@@@@@@@@@*::%@@@@@@@*.-@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@+ %@@@@*.*@@@@@@@@@@@@@@@+-+++#@@@@@@@@@@@@@*: :@@@@@@@@+ *@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@:.@@@@@+ .=*%@@@@@@@@@@@@@@@@@@@@@@@@@@%*=:== %@@@@@@@# *@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@.-@@@@@* :=::--==+@@@@@@@@@@@@@@%*+=-:-=*%@+ @@@@@@@@# #@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@% -@@@@@ +@@@%##* =@@@@@@@@@@@#.:-=+#%@@@@@% =@@@@@@@@:.@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@@%-.+#%= %@@@@@@@# +@@@@@@@@@@# #@@@@@@@@@@@# -@@@@@@@- @@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@@@@#+-==%@@@@@@@@@# -%@@@@@@@@% *@@@@@@@@@@@@%:.*@@@@* *@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%-.=%@@@@@@* #@@@@@@@@@@@@@@*::===-#@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%=::=*#*=.=@@@@@@@@@@@@@@@@@%##@@@@@@@@@@@@@@@@@@@@@@@@@@\n' +
  '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*===+%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@');

// --- ASCII Art 结束 ---

// 使用 appsPath (带 's') 读取目录
const files = fs.readdirSync(appsPath).filter(file => file.endsWith('.js'));


let apps = {};
// 保持你原来的 for...of 循环，更清晰
for (const file of files) {
    try {
        // 使用 appsPath (带 's') 拼接文件路径
        const filePath = path.join(appsPath, file);
        logger.info(`[Doro冒险] 正在尝试导入: file://${filePath}`);
        const imported = await import(`file://${filePath}`);

        // 检查 default 导出
        if (imported.default && imported.default.prototype instanceof plugin) {
            // 键名建议与类名一致或文件名（无后缀）一致
            // 如果 doro-game.js 导出的是 DoroAdventure 类
            apps['DoroAdventure'] = imported.default; // 使用 default
            logger.info(`[${pluginName}] 已载入 (default export): ${file}`);
        } else {
            logger.error(`[${pluginName}] 文件 ${file} 未导出有效的默认插件类`);
        }
    } catch (err) {
        logger.error(`[${pluginName}] 载入失败: ${file}`);
        logger.error(err);
    }
}

export { apps };
